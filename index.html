<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>To My Love - 2026 Starry Sky</title>

<style>
body, html {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: #050810;
    font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
    -webkit-tap-highlight-color: transparent;
}

#canvas {
    position: absolute;
    inset: 0;
    z-index: 1;
}

/* ===== æ‰“å­—æ–‡æœ¬ ===== */
#typing-text {
    position: absolute;
    top: 12%;
    left: 8%;
    right: 8%;
    color: rgba(255,255,255,0.85);
    font-size: clamp(0.9rem, 2.5vw, 1.1rem);
    line-height: 2.2;
    letter-spacing: 0.18em;
    z-index: 10;
    text-shadow: 0 0 15px rgba(255,255,255,0.4);
}

/* ===== 3D æ–‡å­—ç¯ç»• ===== */
.word-container {
    position: absolute;
    top: 50%;
    left: 50%;
    perspective: 1500px;
    transform-style: preserve-3d;
    z-index: 5;
    pointer-events: none;
}

.word-item {
    position: absolute;
    color: #fff;
    opacity: 0;
    white-space: nowrap;
    text-shadow: 0 0 10px #ff9ecd;
    animation: rotate3d 32s infinite linear;
    font-weight: 300;
    font-size: clamp(0.75rem, 2vw, 1rem);
}

@keyframes rotate3d {
    0% { transform: rotateY(0deg) translateZ(380px); opacity: 0; }
    10% { opacity: 0.7; }
    90% { opacity: 0.7; }
    100% { transform: rotateY(360deg) translateZ(380px); opacity: 0; }
}

/* ===== åº•éƒ¨æ–‡å­— ===== */
.footer {
    position: absolute;
    bottom: 20px;
    width: 100%;
    text-align: center;
    color: rgba(255,192,203,0.6);
    font-size: clamp(1.2rem, 4vw, 2rem);
    letter-spacing: 0.35em;
    z-index: 10;
}

/* ===== ç¤¼ç‰©å¼¹çª— ===== */
#gift-modal {
    position: fixed;
    inset: 0;
    background: rgba(5,8,16,0.92);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 100;
    backdrop-filter: blur(6px);
}

.gift-box {
    text-align: center;
    color: rgba(255,255,255,0.9);
    animation: fadeIn 1.4s ease;
}

.gift-title {
    font-size: 3rem;
    margin-bottom: 20px;
}

.gift-text {
    font-size: clamp(1rem,4vw,1.2rem);
    letter-spacing: 0.2em;
    margin-bottom: 30px;
}

#gift-btn {
    padding: 14px 48px;
    font-size: 1rem;
    letter-spacing: 0.3em;
    background: transparent;
    color: rgba(255,192,203,0.9);
    border: 1px solid rgba(255,192,203,0.6);
    border-radius: 40px;
    cursor: pointer;
}

#gift-modal.hide {
    animation: fadeOut 1.2s ease forwards;
}

@keyframes fadeIn {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
}
@keyframes fadeOut {
    to { opacity: 0; visibility: hidden; }
}
</style>
</head>

<body>

<div id="typing-text"></div>
<div class="word-container" id="word-cloud"></div>
<div class="footer">2026, æœ‰ä½ çœŸå¥½ï¼</div>
<canvas id="canvas"></canvas>

<div id="gift-modal">
    <div class="gift-box">
        <div class="gift-title">ğŸ</div>
        <div class="gift-text">ç‚¹å‡»æ‰“å¼€ä½ çš„æ–°å¹´ç¤¼ç‰©</div>
        <button id="gift-btn">æ‰“å¼€</button>
    </div>
</div>

<audio id="bgm" loop preload="auto">
    <source src="é è¿‘.mp3" type="audio/mpeg">
</audio>

<script>
/* ===== åŸºç¡€ ===== */
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const typingElement = document.getElementById('typing-text');
const bgm = document.getElementById('bgm');
const isMobile = /mobile|android|iphone/i.test(navigator.userAgent);


const nameText = "èµµé›ªé›"; // â†â†â† æ”¹è¿™é‡Œ

let width, height;
let stars = [];
let heartParticles = [];
let mouse = {x:0,y:0};
let started = false;
let heartBoost = 3;

/* ===== é˜¶æ®µæ§åˆ¶ ===== */
let stage = "name-1";
let stageTime = 0;
let namePoints = [];

/* ===== é…ç½® ===== */
const config = {
    heartParticleCount: isMobile ? 420 : 800,
    starCount: isMobile ? 500 : 1000,
    messages: [
        "å²å²å¹´å¹´","ä¸‡ç‰©æ˜¯ä½ ","æ–°æ˜¥å¿—å–œ","äººé—´ç†æƒ³","æ¸©æŸ”å…±åº¦","çœ¸ä¸­æ˜Ÿæ²³","Love You","Forever",
        "ä»Šå¤©ä¹Ÿæƒ³é è¿‘ä½ ä¸€ç‚¹","å’Œä½ å¾…åœ¨ä¸€èµ·å°±å¾ˆå®‰å¿ƒ","ä¸–ç•Œåµé—¹ï¼Œä½†ä½ åˆšåˆšå¥½",
        "æ–°çš„ä¸€å¹´ï¼Œæˆ‘è¿˜æ˜¯ç«™åœ¨ä½ è¿™è¾¹","ä¸æ­¢ä»Šå¹´ï¼Œæ˜¯å¾ˆå¤šå¹´",
        "ä½ ä¸€å‡ºç°ï¼Œæˆ‘å°±å¿ƒè½¯","æˆ‘çš„æ¸©æŸ”ï¼Œå¤§æ¦‚éƒ½ç”¨åœ¨ä½ èº«ä¸Šäº†",
        "å¤œè‰²åˆšå¥½ï¼Œä½ ä¹Ÿåˆšå¥½","ä»Šæ™šä¹Ÿæƒ³å¯¹ä½ è¯´æ™šå®‰",
        "With you, I feel home","Still you, always you"
    ],
    longText:
`æƒ³æŠŠæ‰€æœ‰çš„æ¸©æŸ”éƒ½å¯„é€ç»™ä½ ã€‚
æ–°çš„ä¸€å¹´ï¼Œ
æˆ‘ä»¬ä¾ç„¶åœ¨å½¼æ­¤çš„æ˜Ÿè½¨é‡Œå…±é¸£ã€‚
æ„¿ä½ è¢«ä¸–ç•Œæ¸©æŸ”ä»¥å¾…ï¼Œ
è€Œæˆ‘ï¼Œè´Ÿè´£å®ˆæŠ¤è¿™ä»½æ¸©æŸ”ã€‚`
};

function resize(){
    const dpr = window.devicePixelRatio || 1;

    width = window.innerWidth;
    height = window.innerHeight;

    canvas.style.width = width + 'px';
    canvas.style.height = height + 'px';

    canvas.width = Math.floor(width * dpr);
    canvas.height = Math.floor(height * dpr);

    ctx.resetTransform();   // â† éå¸¸é‡è¦
    ctx.scale(dpr, dpr);    // â† åª scale ä¸€æ¬¡
}



/* ===== æ˜Ÿç©º ===== */
function createStars(){
    stars=[];
    for(let i=0;i<config.starCount;i++){
        stars.push({
            x:Math.random()*width,
            y:Math.random()*height,
            size:Math.random()*1.2,
            opacity:Math.random(),
            speed:Math.random()*0.05+0.02,
            blinkSpeed:Math.random()*0.02+0.01
        });
    }
}

/* ===== çˆ±å¿ƒ ===== */
function createHeart(){
    heartParticles=[];
    for(let i=0;i<config.heartParticleCount;i++){
        const t=Math.random()*Math.PI*2;
        const x=16*Math.pow(Math.sin(t),3);
        const y=-(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
        heartParticles.push({
            x:(Math.random()-0.5)*width,
            y:(Math.random()-0.5)*height,
            targetX:x*16,
            targetY:y*16,
            size:Math.random()*2+0.6,
            color:`hsla(${Math.random()*30+330},80%,75%,0.7)`,
            speed:Math.random()*0.04+0.015
        });
    }
}

function getTextPoints(text, offsetX){
    const dpr = window.devicePixelRatio || 1;
    const c = document.createElement('canvas');
    const cx = c.getContext('2d');

    const size = isMobile ? 110 : 150;
    const canvasSize = size * 2;

    c.width = canvasSize * dpr;
    c.height = canvasSize * dpr;
    c.style.width = canvasSize + 'px';
    c.style.height = canvasSize + 'px';

    cx.scale(dpr, dpr);
    cx.font = `bold ${size}px PingFang SC, Microsoft YaHei`;
    cx.fillStyle = '#fff';
    cx.textAlign = 'center';
    cx.textBaseline = 'middle';
    cx.fillText(text, canvasSize / 2, canvasSize / 2);

    const data = cx.getImageData(0, 0, c.width, c.height).data;
    const pts = [];

    // âœ… å¾ªç¯ x å’Œ y
    for (let y = 0; y < c.height; y += 6) {
        for (let x = 0; x < c.width; x += 6) {
            if (data[(y * c.width + x) * 4 + 3] > 150) {
                pts.push({
                    x: x / dpr - canvasSize / 2 + offsetX,
                    y: y / dpr - canvasSize / 2
                });
            }
        }
    }

    return pts;
}



function prepareNamePoints(){
    namePoints=[];
    nameText.split('').forEach((c,i)=>{
        namePoints.push(getTextPoints(c,(i-1)*(isMobile?90:140)));
    });
}

/* ===== æ‰“å­— ===== */
function startTyping(){
    let i=0;
    (function type(){
        if(i<config.longText.length){
            const c=config.longText.charAt(i);
            typingElement.innerHTML+=c==='\n'?'<br>':c;
            i++;
            setTimeout(type,120);
        }
    })();
}

/* ===== 3D æ–‡å­— ===== */
function createWordCloud(){
    const cloud=document.getElementById('word-cloud');
    config.messages.forEach((t,i)=>{
        const d=document.createElement('div');
        d.className='word-item';
        d.innerText=t;
        d.style.animationDelay=`-${i*4}s`;
        d.style.top=`${(Math.random()-0.5)*400}px`;
        cloud.appendChild(d);
    });
}

/* ===== åŠ¨ç”» ===== */
function animate(){
    ctx.fillStyle='#050810';
    ctx.fillRect(0,0,width,height);

    stars.forEach(s=>{
        s.opacity+=s.blinkSpeed;
        if(s.opacity>1||s.opacity<0) s.blinkSpeed*=-1;
        ctx.beginPath();
        ctx.arc(s.x,s.y,s.size,0,Math.PI*2);
        ctx.fillStyle=`rgba(255,255,255,${Math.abs(s.opacity)})`;
        ctx.fill();
        s.y-=s.speed;
        if(s.y<-10) s.y=height+10;
    });

    ctx.save();
    ctx.translate(width/2,height/2);

    heartParticles.forEach((p,i)=>{
        let tx=p.targetX, ty=p.targetY;
        if(stage.startsWith("name")){
            const idx=Number(stage.split("-")[1])-1;
            const pts=namePoints[idx];
            const pt=pts[i%pts.length];
            tx=pt.x; ty=pt.y;
        }
        if(stage==="scatter"){
            tx=(Math.random()-0.5)*width;
            ty=(Math.random()-0.5)*height;
        }
        p.x+=(tx-p.x)*p.speed*heartBoost;
        p.y+=(ty-p.y)*p.speed*heartBoost;
        ctx.beginPath();
        ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
        ctx.fillStyle=p.color;
        ctx.shadowBlur = isMobile ? 4 : 6;
        ctx.shadowColor = p.color;

        ctx.fill();
    });

    ctx.restore();

    stageTime++;
    if(stage==="name-1"&&stageTime>120){stage="name-2";stageTime=0;}
    if(stage==="name-2"&&stageTime>120){stage="name-3";stageTime=0;}
    if(stage==="name-3"&&stageTime>140){stage="scatter";stageTime=0;}
    if(stage==="scatter"&&stageTime>80){stage="heart";stageTime=0;}

    heartBoost+=(1-heartBoost)*0.02;
    requestAnimationFrame(animate);
}

/* ===== ç¤¼ç‰©è§¦å‘ ===== */
document.getElementById('gift-btn').onclick=()=>{
    if(started) return;
    started=true;
    document.getElementById('gift-modal').classList.add('hide');
    setTimeout(()=>document.getElementById('gift-modal').remove(),1200);

    bgm.volume=0;
    bgm.play();
    let v=0;
    const fade=setInterval(()=>{
        v+=0.02;
        bgm.volume=Math.min(v,0.4);
        if(v>=0.4) clearInterval(fade);
    },80);

    resize();
    createStars();
    createHeart();
    prepareNamePoints();
    startTyping();
    createWordCloud();
    animate();
};

window.addEventListener('resize',resize);
</script>
</body>
</html>
